{% extends "layout.html" %}

{% block content %}
<div class="mb-2">
    <h1>üè™ Danh S√°ch S·∫£n Ph·∫©m</h1>
    <p style="color: #666; margin-top: 0.5rem;">Kh√°m ph√° nh·ªØng s·∫£n ph·∫©m c√¥ng ngh·ªá t·ªët nh·∫•t</p>
</div>

{% if products.items %}
    <div class="product-grid">
        {% for product in products.items %}
            <div class="product-card">
                <div class="product-image">
                    {% if product.image_url %}
                        <img src="{{ product.image_url }}" alt="{{ product.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                        <span>üì¶ Kh√¥ng c√≥ ·∫£nh</span>
                    {% endif %}
                </div>
                <div class="product-info">
                    <h3 class="product-name">{{ product.name }}</h3>
                    <p style="color: #888; font-size: 0.9rem; margin-bottom: 0.8rem;">{{ product.description[:50] }}...</p>
                    <div class="product-price">{{ "{:,.0f}".format(product.price) }} ‚Ç´</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="/product/{{ product.id }}" class="btn-secondary" style="flex: 1; text-align: center;">Chi Ti·∫øt</a>
                        {% if session.get('user_id') %}
                            <button onclick="addToCart({{ product.id }})" class="btn-primary" style="flex: 1;">Th√™m V√†o Gi·ªè</button>
                        {% else %}
                            <a href="/login" class="btn-primary" style="flex: 1; text-align: center;">Th√™m V√†o Gi·ªè</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    <div style="text-align: center; margin-top: 2rem;">
        {% if products.has_prev %}
            <a href="/?page={{ products.prev_num }}" class="btn-secondary">‚Üê Trang Tr∆∞·ªõc</a>
        {% endif %}
        
        <span style="margin: 0 1rem;">Trang {{ products.page }} / {{ products.pages }}</span>
        
        {% if products.has_next %}
            <a href="/?page={{ products.next_num }}" class="btn-secondary">Trang Sau ‚Üí</a>
        {% endif %}
    </div>
{% else %}
    <div class="alert alert-info text-center">
        <h3>Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o</h3>
    </div>
{% endif %}

<script>
function addToCart(productId) {
    const quantity = prompt('S·ªë l∆∞·ª£ng:', '1');
    if (quantity && quantity > 0) {
        const formData = new FormData();
        formData.append('quantity', quantity);
        
        fetch(`/add-to-cart/${productId}`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    }
}
</script>
{% endblock %}

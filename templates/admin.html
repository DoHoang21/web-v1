{% extends "layout.html" %}

{% block content %}
<style>
.admin-header {
    margin-bottom: 2rem;
}

.admin-header h1 {
    font-size: 2rem;
    color: #333;
    margin-bottom: 0.5rem;
}

.admin-header p {
    color: #666;
    font-size: 0.95rem;
}

.admin-tabs {
    display: flex;
    gap: 0.5rem;
    border-bottom: 2px solid #e0e0e0;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.admin-tab-btn {
    padding: 0.9rem 1.8rem;
    border: none;
    background: transparent;
    color: #666;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 3px solid transparent;
    position: relative;
    top: 2px;
}

.admin-tab-btn:hover {
    color: #333;
}

.admin-tab-btn.active {
    color: #667eea;
    border-bottom-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
}

.admin-content {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    padding: 2rem;
    margin-bottom: 2rem;
}

.admin-section-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.add-form-section {
    background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
    border: 1px solid #e0e4ff;
    border-radius: 8px;
    padding: 1.8rem;
    margin-bottom: 2rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.form-row.full {
    grid-column: 1 / -1;
}

.table-wrapper {
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

.admin-table thead {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.admin-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.9rem;
}

.admin-table td {
    padding: 0.9rem 1rem;
    border-bottom: 1px solid #f0f0f0;
}

.admin-table tr:hover {
    background: #fafbff;
}

.admin-table tr:last-child td {
    border-bottom: none;
}

.btn-group {
    display: flex;
    gap: 0.5rem;
}

.btn-group button {
    padding: 0.6rem 1rem;
    font-size: 0.85rem;
    font-weight: 500;
    transition: all 0.2s;
}

.status-badge {
    padding: 0.35rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
    display: inline-block;
}

.status-pending { background: #fff3cd; color: #856404; }
.status-paid { background: #d1ecf1; color: #0c5460; }
.status-shipped { background: #d4edda; color: #155724; }
.status-delivered { background: #cce5ff; color: #004085; }

.quantity-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    color: #333;
    font-weight: 500;
    display: inline-block;
}

.quantity-high { background: #d4edda; }
.quantity-medium { background: #fff3cd; }
.quantity-low { background: #f8d7da; }

.empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #999;
}

.empty-state-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .admin-table {
        font-size: 0.85rem;
    }
    
    .admin-table th,
    .admin-table td {
        padding: 0.6rem;
    }
    
    .btn-group {
        flex-direction: column;
    }
    
    .btn-group button {
        width: 100%;
    }
}
</style>

<div class="admin-header">
    <h1>üë®‚Äçüíº Qu·∫£n Tr·ªã H·ªá Th·ªëng</h1>
    <p>Qu·∫£n l√Ω s·∫£n ph·∫©m, ƒë∆°n h√†ng v√† ng∆∞·ªùi d√πng t·ª´ b·∫£ng ƒëi·ªÅu khi·ªÉn n√†y</p>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div style="margin-bottom: 2rem;">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {% if category == 'success' %}‚úì{% else %}‚ö†Ô∏è{% endif %} {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<div class="admin-tabs">
    <button class="admin-tab-btn active" onclick="switchTab('products')">üì¶ S·∫£n Ph·∫©m</button>
    <button class="admin-tab-btn" onclick="switchTab('orders')">üìã ƒê∆°n H√†ng</button>
    <button class="admin-tab-btn" onclick="switchTab('users')">üë• Ng∆∞·ªùi D√πng</button>
</div>

<!-- ==================== PRODUCTS TAB ==================== -->
<div id="products-tab" class="admin-content">
    <div class="admin-section-title">üì¶ Qu·∫£n L√Ω S·∫£n Ph·∫©m</div>
    
    <div class="add-form-section">
        <h3 style="margin: 0 0 1.5rem 0; color: #333; font-size: 1.05rem;">‚ûï Th√™m S·∫£n Ph·∫©m M·ªõi</h3>
        <form method="POST" action="{{ url_for('admin_add_product') }}">
            <div class="form-row">
                <div class="form-group">
                    <label for="name">T√™n S·∫£n Ph·∫©m</label>
                    <input type="text" id="name" name="name" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." required>
                </div>
                <div class="form-group">
                    <label for="price">Gi√° (‚Ç´)</label>
                    <input type="number" id="price" name="price" step="0.01" min="0" placeholder="0" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="quantity">S·ªë L∆∞·ª£ng</label>
                    <input type="number" id="quantity" name="quantity" min="0" placeholder="0" required>
                </div>
                <div class="form-group">
                    <label for="image_url">URL ·∫¢nh</label>
                    <input type="text" id="image_url" name="image_url" placeholder="https://...">
                </div>
            </div>
            
            <div class="form-row full">
                <div class="form-group">
                    <label for="description">M√¥ T·∫£ S·∫£n Ph·∫©m</label>
                    <textarea id="description" name="description" placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m..."></textarea>
                </div>
            </div>
            
            <button type="submit" class="btn-primary" style="width: 100%; padding: 0.9rem; font-weight: 600;">‚ûï Th√™m S·∫£n Ph·∫©m</button>
        </form>
    </div>
    
    {% if products %}
        <div class="table-wrapper">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">ID</th>
                        <th style="width: 25%;">T√™n S·∫£n Ph·∫©m</th>
                        <th style="width: 15%;">Gi√°</th>
                        <th style="width: 12%;">S·ªë L∆∞·ª£ng</th>
                        <th style="width: 43%;">H√†nh ƒê·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                        <tr>
                            <td>#{{ product.id }}</td>
                            <td>
                                <strong>{{ product.name }}</strong>
                                <div style="font-size: 0.8rem; color: #999; margin-top: 0.3rem;">
                                    {{ product.description[:50] }}{% if product.description and product.description|length > 50 %}...{% endif %}
                                </div>
                            </td>
                            <td>
                                <span style="color: #667eea; font-weight: 600;">{{ "{:,.0f}".format(product.price) }}‚Ç´</span>
                            </td>
                            <td>
                                {% if product.quantity > 10 %}
                                    <span class="quantity-badge quantity-high">{{ product.quantity }}</span>
                                {% elif product.quantity > 0 %}
                                    <span class="quantity-badge quantity-medium">{{ product.quantity }}</span>
                                {% else %}
                                    <span class="quantity-badge quantity-low">{{ product.quantity }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="btn-group">
                                    <button class="btn-primary" data-product-id="{{ product.id }}" onclick="openEditModal(this.dataset.productId)" style="background: #4CAF50;">‚úèÔ∏è S·ª≠a</button>
                                    <button class="btn-danger" data-product-id="{{ product.id }}" onclick="deleteProduct(this.dataset.productId)">üóëÔ∏è X√≥a</button>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üì¶</div>
            <h3>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</h3>
            <p>H√£y th√™m s·∫£n ph·∫©m m·ªõi b·∫±ng form ph√≠a tr√™n</p>
        </div>
    {% endif %}
</div>

<!-- ==================== ORDERS TAB ==================== -->
<div id="orders-tab" class="admin-content" style="display: none;">
    <div class="admin-section-title">üìã Qu·∫£n L√Ω ƒê∆°n H√†ng</div>
    
    {% if orders %}
        <div class="table-wrapper">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th style="width: 8%;">M√£ ƒêH</th>
                        <th style="width: 18%;">Kh√°ch H√†ng</th>
                        <th style="width: 15%;">T·ªïng Ti·ªÅn</th>
                        <th style="width: 20%;">Tr·∫°ng Th√°i</th>
                        <th style="width: 17%;">Ng√†y T·∫°o</th>
                        <th style="width: 22%;">H√†nh ƒê·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                        <tr>
                            <td><strong>#{{ order.id }}</strong></td>
                            <td>{{ order.user.username if order.user else 'N/A' }}</td>
                            <td>
                                <span style="color: #667eea; font-weight: 600;">{{ "{:,.0f}".format(order.total_price) }}‚Ç´</span>
                            </td>
                            <td>
                                <select class="status-select" data-order-id="{{ order.id }}" onchange="updateOrderStatus(this.dataset.orderId, this.value)" style="padding: 0.6rem; border-radius: 6px; border: 1px solid #ddd; font-weight: 500; cursor: pointer;">
                                    <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>‚è≥ Ch·ªù X√°c Nh·∫≠n</option>
                                    <option value="paid" {% if order.status == 'paid' %}selected{% endif %}>‚úì ƒê√£ Thanh To√°n</option>
                                    <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>üì¶ ƒêang G·ª≠i</option>
                                    <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>üéÅ ƒê√£ Giao</option>
                                </select>
                            </td>
                            <td style="font-size: 0.9rem;">{{ order.created_at.strftime('%d/%m/%Y %H:%M') if order.created_at else 'N/A' }}</td>
                            <td>
                                <button class="btn-primary" data-order-id="{{ order.id }}" onclick="viewOrder(this.dataset.orderId)" style="padding: 0.6rem 1rem;">üëÅÔ∏è Xem Chi Ti·∫øt</button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <h3>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h3>
            <p>C√°c ƒë∆°n h√†ng s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y</p>
        </div>
    {% endif %}
</div>

<!-- ==================== USERS TAB ==================== -->
<div id="users-tab" class="admin-content" style="display: none;">
    <div class="admin-section-title">üë• Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</div>
    
    {% if users %}
        <div class="table-wrapper">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th style="width: 8%;">ID</th>
                        <th style="width: 20%;">T√™n ƒêƒÉng Nh·∫≠p</th>
                        <th style="width: 28%;">Email</th>
                        <th style="width: 15%;">Quy·ªÅn</th>
                        <th style="width: 29%;">Ng√†y T·∫°o</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                        <tr>
                            <td>#{{ user.id }}</td>
                            <td><strong>{{ user.username }}</strong></td>
                            <td style="font-size: 0.9rem; color: #666;">{{ user.email }}</td>
                            <td>
                                {% if user.is_admin %}
                                    <span class="status-badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">üëÆ Admin</span>
                                {% else %}
                                    <span class="status-badge" style="background: #e8eef7; color: #667eea;">üë§ User</span>
                                {% endif %}
                            </td>
                            <td style="font-size: 0.9rem;">{{ user.created_at.strftime('%d/%m/%Y') if user.created_at else 'N/A' }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üë•</div>
            <h3>Ch∆∞a c√≥ ng∆∞·ªùi d√πng n√†o</h3>
            <p>Ng∆∞·ªùi d√πng ƒëƒÉng k√Ω s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y</p>
        </div>
    {% endif %}
</div>

<!-- ==================== EDIT PRODUCT MODAL ==================== -->
<div id="editProductModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚úèÔ∏è Ch·ªânh S·ª≠a S·∫£n Ph·∫©m</h2>
            <button class="modal-close" onclick="closeEditModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="editFormContainer">
                <form id="editProductForm">
                    <input type="hidden" id="editProductId" name="product_id">
                    
                    <div class="form-group">
                        <label for="editName">T√™n S·∫£n Ph·∫©m</label>
                        <input type="text" id="editName" name="name" required>
                        <span class="form-error form-error-name"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="editPrice">Gi√° (‚Ç´)</label>
                        <input type="number" id="editPrice" name="price" step="0.01" min="0" required>
                        <span class="form-error form-error-price"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="editQuantity">S·ªë L∆∞·ª£ng</label>
                        <input type="number" id="editQuantity" name="quantity" min="0" required>
                        <span class="form-error form-error-quantity"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="editDescription">M√¥ T·∫£</label>
                        <textarea id="editDescription" name="description"></textarea>
                        <span class="form-error form-error-description"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="editImageUrl">URL ·∫¢nh</label>
                        <input type="text" id="editImageUrl" name="image_url">
                        <span class="form-error form-error-image_url"></span>
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closeEditModal()">H·ªßy</button>
            <button type="button" class="btn-primary" id="submitEditBtn" onclick="submitEditProduct()">üíæ L∆∞u Thay ƒê·ªïi</button>
        </div>
    </div>
</div>

<script>
// Tab Management
function switchTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('[id$="-tab"]').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Deactivate all buttons
    document.querySelectorAll('.admin-tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(tabName + '-tab').style.display = 'block';
    event.target.classList.add('active');
}

// Edit Modal Functions
function openEditModal(productId) {
    const modal = document.getElementById('editProductModal');
    const submitBtn = document.getElementById('submitEditBtn');
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner"></span>ƒêang t·∫£i...';
    
    fetch(`/admin/product/${productId}`)
        .then(response => response.ok ? response.json() : null)
        .then(data => {
            if (data) {
                document.getElementById('editProductId').value = data.id;
                document.getElementById('editName').value = data.name;
                document.getElementById('editPrice').value = data.price;
                document.getElementById('editQuantity').value = data.quantity;
                document.getElementById('editDescription').value = data.description || '';
                document.getElementById('editImageUrl').value = data.image_url || '';
            } else {
                loadProductFromTable(productId);
            }
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'üíæ L∆∞u Thay ƒê·ªïi';
            modal.classList.add('show');
            clearErrors();
        })
        .catch(error => {
            console.warn('Error:', error);
            loadProductFromTable(productId);
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'üíæ L∆∞u Thay ƒê·ªïi';
            modal.classList.add('show');
        });
}

function loadProductFromTable(productId) {
    const row = document.querySelector(`button[onclick*="openEditModal(${productId})"]`).closest('tr');
    const cells = row.querySelectorAll('td');
    
    document.getElementById('editProductId').value = productId;
    document.getElementById('editName').value = cells[1].querySelector('strong').textContent;
    document.getElementById('editPrice').value = cells[2].textContent.replace(/[^\d.]/g, '');
    document.getElementById('editQuantity').value = cells[3].textContent.trim();
}

function closeEditModal() {
    const modal = document.getElementById('editProductModal');
    modal.classList.remove('show');
    document.getElementById('editProductForm').reset();
    clearErrors();
}

function clearErrors() {
    document.querySelectorAll('.form-error').forEach(el => el.textContent = '');
    document.querySelectorAll('#editProductForm input, #editProductForm textarea').forEach(el => {
        el.classList.remove('error');
    });
}

function validateForm() {
    clearErrors();
    let isValid = true;
    
    const name = document.getElementById('editName').value.trim();
    const price = document.getElementById('editPrice').value.trim();
    const quantity = document.getElementById('editQuantity').value.trim();
    
    if (!name) {
        showError('editName', 'T√™n s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng');
        isValid = false;
    }
    
    if (!price || isNaN(price) || parseFloat(price) < 0) {
        showError('editPrice', 'Gi√° ph·∫£i l√† s·ªë d∆∞∆°ng');
        isValid = false;
    }
    
    if (!quantity || isNaN(quantity) || parseInt(quantity) < 0) {
        showError('editQuantity', 'S·ªë l∆∞·ª£ng ph·∫£i l√† s·ªë kh√¥ng √¢m');
        isValid = false;
    }
    
    return isValid;
}

function showError(fieldId, message) {
    const field = document.getElementById(fieldId);
    field.classList.add('error');
    const errorSpan = field.parentElement.querySelector('.form-error');
    if (errorSpan) errorSpan.textContent = message;
}

function submitEditProduct() {
    if (!validateForm()) return;
    
    const productId = document.getElementById('editProductId').value;
    const submitBtn = document.getElementById('submitEditBtn');
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner"></span>ƒêang l∆∞u...';
    
    const formData = new FormData();
    formData.append('name', document.getElementById('editName').value.trim());
    formData.append('price', document.getElementById('editPrice').value.trim());
    formData.append('quantity', document.getElementById('editQuantity').value.trim());
    formData.append('description', document.getElementById('editDescription').value.trim());
    formData.append('image_url', document.getElementById('editImageUrl').value.trim());
    
    fetch(`/admin/update-product/${productId}`, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('‚úì ' + data.message, 'success');
            closeEditModal();
            setTimeout(() => location.reload(), 1200);
        } else {
            showToast('‚ùå ' + data.message, 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'üíæ L∆∞u Thay ƒê·ªïi';
        }
    })
    .catch(error => {
        showToast('‚ùå L·ªói: ' + error.message, 'error');
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'üíæ L∆∞u Thay ƒê·ªïi';
    });
}

// Delete Product
function deleteProduct(productId) {
    showConfirmDialog(
        '‚ö†Ô∏è X√≥a S·∫£n Ph·∫©m',
        'B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh√¥ng?\nH√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!',
        () => performDelete(productId)
    );
}

function performDelete(productId) {
    const btn = document.querySelector(`button[onclick="deleteProduct(${productId})"]`);
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span>X√≥a...';
    
    fetch(`/admin/delete-product/${productId}`, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('‚úì ' + data.message, 'success');
                setTimeout(() => location.reload(), 1200);
            } else {
                showToast('‚ùå ' + data.message, 'error');
                btn.disabled = false;
                btn.innerHTML = 'üóëÔ∏è X√≥a';
            }
        })
        .catch(error => {
            showToast('‚ùå L·ªói: ' + error.message, 'error');
            btn.disabled = false;
            btn.innerHTML = 'üóëÔ∏è X√≥a';
        });
}

// Order Management
function updateOrderStatus(orderId, status) {
    const select = event.target;
    select.disabled = true;
    
    const formData = new FormData();
    formData.append('status', status);
    
    fetch(`/admin/update-order-status/${orderId}`, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('‚úì ' + data.message, 'success');
        } else {
            showToast('‚ùå ' + data.message, 'error');
            location.reload();
        }
    })
    .catch(error => {
        showToast('‚ùå L·ªói', 'error');
        location.reload();
    })
    .finally(() => select.disabled = false);
}

function viewOrder(orderId) {
    fetch(`/admin/order/${orderId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                let msg = `üì¶ ƒê∆†N H√ÄNG #${orderId}\n`;
                msg += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
                data.items.forEach((item, i) => {
                    msg += `${i+1}. ${item.product_name}\n`;
                    msg += `   üìä ${item.quantity}x |üí∞ ${item.price}‚Ç´\n`;
                });
                msg += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
                msg += `üíµ T·ªîNG: ${data.total}‚Ç´`;
                alert(msg);
            } else {
                showToast('‚ùå Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng', 'error');
            }
        })
        .catch(error => showToast('‚ùå L·ªói', 'error'));
}

// Toast Notifications
function showToast(message, type = 'success') {
    let container = document.getElementById('toastContainer');
    if (!container) {
        container = document.createElement('div');
        container.id = 'toastContainer';
        container.className = 'toast-container';
        document.body.appendChild(container);
    }
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `<span>${message}</span>`;
    container.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('removing');
        setTimeout(() => toast.remove(), 300);
    }, 3500);
}

// Confirm Dialog
function showConfirmDialog(title, message, onConfirm) {
    let modal = document.getElementById('customConfirmModal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'customConfirmModal';
        modal.className = 'confirm-modal';
        modal.innerHTML = `
            <div class="confirm-content">
                <div class="confirm-icon"></div>
                <h3 id="confirmTitle"></h3>
                <p id="confirmMessage"></p>
                <div class="confirm-actions">
                    <button class="btn-cancel" id="confirmCancel">H·ªßy</button>
                    <button class="btn-confirm" id="confirmConfirm">X√°c Nh·∫≠n</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    document.querySelector('#customConfirmModal .confirm-icon').textContent = title.split(' ')[0];
    document.getElementById('confirmTitle').textContent = title;
    document.getElementById('confirmMessage').textContent = message;
    
    document.getElementById('confirmConfirm').onclick = () => {
        modal.classList.remove('show');
        setTimeout(onConfirm, 300);
    };
    
    document.getElementById('confirmCancel').onclick = () => modal.classList.remove('show');
    
    modal.onclick = (e) => e.target === modal && modal.classList.remove('show');
    modal.classList.add('show');
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    const editModal = document.getElementById('editProductModal');
    if (editModal) {
        editModal.addEventListener('click', function(e) {
            if (e.target === this) closeEditModal();
        });
    }
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && editModal.classList.contains('show')) {
            closeEditModal();
        }
    });
});
</script>

{% endblock %}

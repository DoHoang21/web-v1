{% extends "layout.html" %}

{% block content %}
<h1>üë®‚Äçüíº Trang Qu·∫£n Tr·ªã</h1>

<div style="margin-top: 2rem;">
    <!-- Tabs navigation -->
    <div style="display: flex; gap: 1rem; border-bottom: 2px solid #e0e0e0; margin-bottom: 2rem;">
        <button id="btn-products" class="tab-btn" data-tab="products" style="background: #667eea; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px 5px 0 0; cursor: pointer;">üì¶ S·∫£n Ph·∫©m</button>
        <button id="btn-orders" class="tab-btn" data-tab="orders" style="background: transparent; color: #666; padding: 0.8rem 1.5rem; border: none; cursor: pointer;">üìã ƒê∆°n H√†ng</button>
        <button id="btn-users" class="tab-btn" data-tab="users" style="background: transparent; color: #666; padding: 0.8rem 1.5rem; border: none; cursor: pointer;">üë• Ng∆∞·ªùi D√πng</button>
    </div>

    <!-- Qu·∫£n l√Ω s·∫£n ph·∫©m -->
    <div id="products-tab" class="tab-content">
        <h2 style="margin-bottom: 1.5rem;">Qu·∫£n L√Ω S·∫£n Ph·∫©m</h2>
        
        <!-- Form th√™m s·∫£n ph·∫©m -->
        <div style="background: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3>‚ûï Th√™m S·∫£n Ph·∫©m M·ªõi</h3>
            <form method="POST" action="/admin/add-product" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1rem;">
                <div class="form-group">
                    <label for="name">T√™n S·∫£n Ph·∫©m:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="price">Gi√° (‚Ç´):</label>
                    <input type="number" id="price" name="price" step="0.01" required>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="description">M√¥ T·∫£:</label>
                    <textarea id="description" name="description"></textarea>
                </div>
                <div class="form-group">
                    <label for="quantity">S·ªë L∆∞·ª£ng:</label>
                    <input type="number" id="quantity" name="quantity" required>
                </div>
                <div class="form-group">
                    <label for="image_url">URL ·∫¢nh:</label>
                    <input type="text" id="image_url" name="image_url">
                </div>
                <button type="submit" class="btn-primary" style="grid-column: 1 / -1;">Th√™m S·∫£n Ph·∫©m</button>
            </form>
        </div>

        <!-- Danh s√°ch s·∫£n ph·∫©m -->
        {% if products %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√™n</th>
                        <th>Gi√°</th>
                        <th>S·ªë L∆∞·ª£ng</th>
                        <th>H√†nh ƒê·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                        <tr>
                            <td>{{ product.id }}</td>
                            <td>{{ product.name }}</td>
                            <td>{{ "{:,.0f}".format(product.price) }} ‚Ç´</td>
                            <td>{{ product.quantity }}</td>
                            <td>
                                <button class="btn-secondary edit-product-btn" data-product-id="{{ product.id }}">S·ª≠a</button>
                                <button class="btn-danger delete-product-btn" data-product-id="{{ product.id }}">X√≥a</button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>

    <!-- Qu·∫£n l√Ω ƒë∆°n h√†ng -->
    <div id="orders-tab" class="tab-content" style="display: none;">
        <h2 style="margin-bottom: 1.5rem;">Qu·∫£n L√Ω ƒê∆°n H√†ng</h2>
        
        {% if orders %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Kh√°ch H√†ng</th>
                        <th>T·ªïng Ti·ªÅn</th>
                        <th>Tr·∫°ng Th√°i</th>
                        <th>Ng√†y T·∫°o</th>
                        <th>H√†nh ƒê·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                        <tr>
                            <td>#{{ order.id }}</td>
                            <td>{{ order.user.username }}</td>
                            <td>{{ "{:,.0f}".format(order.total_price) }} ‚Ç´</td>
                            <td>
                                <select class="status-select" data-order-id="{{ order.id }}" style="padding: 0.5rem; border-radius: 5px; border: 1px solid #ddd;">
                                    <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Ch·ªù X√°c Nh·∫≠n</option>
                                    <option value="paid" {% if order.status == 'paid' %}selected{% endif %}>ƒê√£ Thanh To√°n</option>
                                    <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>ƒê√£ G·ª≠i</option>
                                    <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>ƒê√£ Giao</option>
                                </select>
                            </td>
                            <td>{{ order.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                            <td>
                                <button class="btn-secondary view-order-btn" data-order-id="{{ order.id }}">Xem</button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>

    <!-- Qu·∫£n l√Ω ng∆∞·ªùi d√πng -->
    <div id="users-tab" class="tab-content" style="display: none;">
        <h2 style="margin-bottom: 1.5rem;">Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</h2>
        
        {% if users %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√™n ƒêƒÉng Nh·∫≠p</th>
                        <th>Email</th>
                        <th>Quy·ªÅn</th>
                        <th>Ng√†y T·∫°o</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td>{{ user.username }}</td>
                            <td>{{ user.email }}</td>
                            <td>
                                {% if user.is_admin %}
                                    <span style="background: #667eea; color: white; padding: 0.3rem 0.8rem; border-radius: 20px;">Admin</span>
                                {% else %}
                                    <span style="background: #e0e0e0; color: #666; padding: 0.3rem 0.8rem; border-radius: 20px;">User</span>
                                {% endif %}
                            </td>
                            <td>{{ user.created_at.strftime('%d/%m/%Y') }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            showTab(tabName);
        });
    });

    // Edit product buttons
    document.querySelectorAll('.edit-product-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            editProduct(productId);
        });
    });

    // Delete product buttons
    document.querySelectorAll('.delete-product-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            deleteProduct(productId);
        });
    });

    // Status select change
    document.querySelectorAll('.status-select').forEach(select => {
        select.addEventListener('change', function() {
            const orderId = this.getAttribute('data-order-id');
            const status = this.value;
            updateOrderStatus(orderId, status);
        });
    });

    // View order buttons
    document.querySelectorAll('.view-order-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const orderId = this.getAttribute('data-order-id');
            viewOrder(orderId);
        });
    });
});

function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.background = 'transparent';
        btn.style.color = '#666';
    });
    
    // Show selected tab
    document.getElementById(tabName + '-tab').style.display = 'block';
    document.getElementById('btn-' + tabName).style.background = '#667eea';
    document.getElementById('btn-' + tabName).style.color = 'white';
}

function editProduct(productId) {
    alert('Ch·ª©c nƒÉng ch·ªânh s·ª≠a s·∫Ω ƒë∆∞·ª£c th√™m v√†o');
}

function deleteProduct(productId) {
    if (confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) {
        fetch(`/admin/delete-product/${productId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            location.reload();
        });
    }
}

function updateOrderStatus(orderId, status) {
    const formData = new FormData();
    formData.append('status', status);
    
    fetch(`/admin/update-order-status/${orderId}`, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
    });
}

function viewOrder(orderId) {
    alert('Chi ti·∫øt ƒë∆°n h√†ng #' + orderId);
}
</script>
{% endblock %}
